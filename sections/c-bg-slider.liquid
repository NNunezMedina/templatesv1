{% style %}
#slider-{{ section.id }} {
  position: relative;
  overflow: hidden;
}

#slider-{{ section.id }} .slide {
  display: none;
  width: 100%;
  position: relative;
}

#slider-{{ section.id }} .slide.active {
  display: block;
}

#slider-{{ section.id }} img.desktop {
  width: 100%;
  height: auto;
  display: block;
}

#slider-{{ section.id }} img.mobile {
  width: 100%;
  height: auto;
  display: none;
}

#slider-{{ section.id }} .content {
  position: absolute;
  top: 50%;
  left: 0;
  width: 100%;
  text-align: center;
  transform: translateY(-50%);
  color: white;
  z-index: 2;
}

#slider-{{ section.id }} .overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  z-index: 1;
}

#slider-{{ section.id }} .content h2 {
  font-size: {{ section.settings.title_font_size_desktop }}px;
  margin:0 0 2px 0;
  line-height: normal;
}

#slider-{{ section.id }} .content p {
  font-size: {{ section.settings.subtitle_font_size_desktop }}px;
  margin:0 0 2px 0;
  line-height: normal;
}

#slider-{{ section.id }} .content a {
  display: inline-block;
  background: {{ section.settings.button_bg_color }};
  color: {{ section.settings.button_text_color }};
  padding: 10px 20px;
  margin-top: 16px;
  text-decoration: none;
  border-radius: {{ section.settings.button_radius }}px;
  transition: all 0.3s ease;
}

#slider-{{ section.id }} .content a:hover {
  background: {{ section.settings.button_bg_hover }};
  color: {{ section.settings.button_text_hover }};
}

#slider-{{ section.id }} .controls {
  position: absolute;
  top: 50%;
  width: 100%;
  z-index: 3;
  display: flex;
  justify-content: space-between;
  pointer-events: none;
}

#slider-{{ section.id }} .arrow {
  font-size: 2rem;
  background: none;
  border: none;
  color: {{ section.settings.arrow_color }};
  padding: 0 1rem;
  cursor: pointer;
  pointer-events: all;
  z-index: 4;
}

#slider-{{ section.id }} .dots {
  text-align: center;
  margin-top: 1rem;
}

#slider-{{ section.id }} .dot {
  width: 10px;
  height: 10px;
  background: {{ section.settings.dot_color }};
  border-radius: 50%;
  display: inline-block;
  margin: 0 5px;
  cursor: pointer;
}

#slider-{{ section.id }} .dot.active {
  background: {{ section.settings.dot_active_color }};
}

#slider-{{ section.id }} .desktop-align-left {
  text-align: left;
}

#slider-{{ section.id }} .desktop-align-center {
  text-align: center;
}

#slider-{{ section.id }} .desktop-align-right {
  text-align: right;
}

{% for i in (0..100) %}
  #slider-{{ section.id }} .desktop-padding-{{ i }} {
    padding-left: {{ i }}px;
    padding-right: {{ i }}px;
  }
{% endfor %}

@media screen and (max-width: 768px) {
  #slider-{{ section.id }} .content {
    position: static;
    transform: none;
    background: white;
    color: black;
    padding: 1rem;
  }

  #slider-{{ section.id }} .overlay {
    display: none;
  }

  #slider-{{ section.id }} img.desktop {
    display: none;
  }

  #slider-{{ section.id }} img.mobile {
    display: block;
  }

  #slider-{{ section.id }} .controls {
  transform: translateY(-50%);
  padding: 0 10px;
}
 
#slider-{{ section.id }} .mobile-align-left {
    text-align: left;
  }

  #slider-{{ section.id }} .mobile-align-center {
    text-align: center;
  }

  #slider-{{ section.id }} .mobile-align-right {
    text-align: right;
  }

  #slider-{{ section.id }} .content {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  #slider-{{ section.id }} .content h2 {
    font-size: {{ section.settings.title_font_size_mobile }}px;
  }

  #slider-{{ section.id }} .content p {
    font-size: {{ section.settings.subtitle_font_size_mobile }}px;
    margin:10px 0 8px 0;
  }

  #slider-{{ section.id }} .content a {
  margin-top: 8px;
}
}
{% endstyle %}

<div id="slider-{{ section.id }}">
  <div class="slider-slides">
    {% for block in section.blocks %}
      <div class="slide{% if forloop.index0 == 0 %} active{% endif %}" data-index="{{ forloop.index0 }}">
        {% if block.settings.bg_desktop %}
          <img src="{{ block.settings.bg_desktop | image_url: width: 2000 }}" class="desktop" alt="Slide">
        {% endif %}
        {% if block.settings.bg_mobile %}
          <img src="{{ block.settings.bg_mobile | image_url: width: 1000 }}" class="mobile" alt="Slide">
        {% endif %}
        <div class="overlay"></div>
        <div
            class="content
                desktop-align-{{ block.settings.text_align }}
                mobile-align-{{ block.settings.text_align_mobile }}
                desktop-padding-{{ block.settings.padding_x_desktop }}"
            >
          {% if block.settings.title != blank %}<h2>{{ block.settings.title }}</h2>{% endif %}
          {% if block.settings.subtitle != blank %}<p>{{ block.settings.subtitle }}</p>{% endif %}
          {% if block.settings.button_text != blank %}<a href="{{ block.settings.button_link }}">{{ block.settings.button_text }}</a>{% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="controls">
    <button class="arrow left" id="prev-{{ section.id }}">&#10094;</button>
    <button class="arrow right" id="next-{{ section.id }}">&#10095;</button>
  </div>

  <div class="dots" id="dots-{{ section.id }}">
    {% for block in section.blocks %}
      <span class="dot{% if forloop.index0 == 0 %} active{% endif %}" data-slide="{{ forloop.index0 }}"></span>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const slider = document.querySelector('#slider-{{ section.id }}');
    const slides = slider.querySelectorAll('.slide');
    const dots = slider.querySelectorAll('.dot');
    const prevBtn = slider.querySelector('#prev-{{ section.id }}');
    const nextBtn = slider.querySelector('#next-{{ section.id }}');
    let current = 0;
    let autoplayInterval;

    const sliderSettings = {
      autoplay: {{ section.settings.autoplay | json }},
      speed: {{ section.settings.autoplay_speed | default: 5 }} * 1000
    };

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
      });
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
      });
      current = index;
    }

    function nextSlide() {
      let index = (current + 1) % slides.length;
      showSlide(index);
    }

    function prevSlide() {
      let index = (current - 1 + slides.length) % slides.length;
      showSlide(index);
    }

    // Botones
    prevBtn.addEventListener('click', () => {
      prevSlide();
      resetAutoplay();
    });

    nextBtn.addEventListener('click', () => {
      nextSlide();
      resetAutoplay();
    });

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        let index = parseInt(dot.dataset.slide);
        showSlide(index);
        resetAutoplay();
      });
    });

    // Swipe
    let startX = 0;
    let isDragging = false;

    function handleSwipeStart(e) {
      isDragging = true;
      startX = e.touches ? e.touches[0].clientX : e.clientX;
    }

    function handleSwipeMove(e) {
      if (!isDragging) return;
      const currentX = e.touches ? e.touches[0].clientX : e.clientX;
      const diffX = currentX - startX;

      if (Math.abs(diffX) > 50) {
        isDragging = false;
        if (diffX > 0) {
          prevSlide();
        } else {
          nextSlide();
        }
        resetAutoplay();
      }
    }

    function handleSwipeEnd() {
      isDragging = false;
    }

    const swipeTarget = slider.querySelector('.slider-slides');
    swipeTarget.addEventListener('touchstart', handleSwipeStart);
    swipeTarget.addEventListener('touchmove', handleSwipeMove);
    swipeTarget.addEventListener('touchend', handleSwipeEnd);
    swipeTarget.addEventListener('mousedown', handleSwipeStart);
    swipeTarget.addEventListener('mousemove', handleSwipeMove);
    swipeTarget.addEventListener('mouseup', handleSwipeEnd);
    swipeTarget.addEventListener('mouseleave', handleSwipeEnd);

    // Autoplay
    function startAutoplay() {
      if (sliderSettings.autoplay) {
        autoplayInterval = setInterval(nextSlide, sliderSettings.speed);
      }
    }

    function resetAutoplay() {
      if (sliderSettings.autoplay) {
        clearInterval(autoplayInterval);
        startAutoplay();
      }
    }

    startAutoplay();
  });
</script>

{% schema %}
{
  "name": "C BG Slider",
  "settings": [
  {
    "type": "color",
    "id": "arrow_color",
    "label": "Color de flechas",
    "default": "#ffffff"
  },
  {
  "type": "color",
  "id": "dot_color",
  "label": "Color de los dots",
  "default": "#ccc"
   },
  {
  "type": "color",
  "id": "dot_active_color",
  "label": "Color del dot activo",
  "default": "#000000"
   },
   {
  "type": "color",
  "id": "button_bg_color",
  "label": "Color de fondo del botón",
  "default": "#ffffff"
},
{
  "type": "color",
  "id": "button_text_color",
  "label": "Color del texto del botón",
  "default": "#000000"
},
{
  "type": "range",
  "id": "button_radius",
  "label": "Bordes redondeados",
  "min": 4,
  "max": 48,
  "step": 4,
  "unit": "px",
  "default": 12
},
{
  "type": "color",
  "id": "button_bg_hover",
  "label": "Color de fondo hover del botón",
  "default": "#000000"
},
{
  "type": "color",
  "id": "button_text_hover",
  "label": "Color del texto hover del botón",
  "default": "#ffffff"
},
{
  "type": "range",
  "id": "title_font_size_desktop",
  "label": "Tamaño título en desktop",
  "min": 10,
  "max": 80,
  "step": 2,
  "unit": "px",
  "default": 32
},
{
  "type": "range",
  "id": "title_font_size_mobile",
  "label": "Tamaño título en mobile",
  "min": 10,
  "max": 80,
  "step": 2,
  "unit": "px",
  "default": 24
},
{
  "type": "range",
  "id": "subtitle_font_size_desktop",
  "label": "Tamaño subtítulo en desktop",
  "min": 10,
  "max": 60,
  "step": 2,
  "unit": "px",
  "default": 18
},
{
  "type": "range",
  "id": "subtitle_font_size_mobile",
  "label": "Tamaño subtítulo en mobile",
  "min": 10,
  "max": 60,
  "step": 2,
  "unit": "px",
  "default": 16
},
{
  "type": "checkbox",
  "id": "autoplay",
  "label": "Activar autoplay",
  "default": false
},
{
  "type": "range",
  "id": "autoplay_speed",
  "label": "Velocidad de autoplay (segundos)",
  "min": 2,
  "max": 10,
  "step": 1,
  "default": 5
}
],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
  { "type": "image_picker", "id": "bg_desktop", "label": "Imagen desktop" },
  { "type": "image_picker", "id": "bg_mobile", "label": "Imagen mobile" },
  { "type": "text", "id": "title", "label": "Título" },
  { "type": "text", "id": "subtitle", "label": "Subtítulo" },
  { "type": "text", "id": "button_text", "label": "Texto del botón" },
  { "type": "url", "id": "button_link", "label": "Enlace del botón" },
  {
    "type": "select",
    "id": "text_align",
    "label": "Alineación del texto (desktop)",
    "default": "center",
    "options": [
      { "value": "left", "label": "Izquierda" },
      { "value": "center", "label": "Centro" },
      { "value": "right", "label": "Derecha" }
    ]
  },
  {
  "type": "select",
  "id": "text_align_mobile",
  "label": "Alineación del texto (mobile)",
  "default": "center",
  "options": [
    { "value": "left", "label": "Izquierda" },
    { "value": "center", "label": "Centro" },
    { "value": "right", "label": "Derecha" }
  ]
},
  {
  "type": "range",
  "id": "padding_x_desktop",
  "label": "Padding lateral Desktop",
  "min": 0,
  "max": 100,
  "step": 5,
  "unit": "px",
  "default": 40
},
]
    },
  ],
  "presets": [
    { "name": "C BG Slider" }
  ]
}
{% endschema %}
